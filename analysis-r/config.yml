# -----------------------------------------------------------------------------
# CENTRAL CONFIGURATION FILE FOR R-BASED ANALYSIS PIPELINE
# -----------------------------------------------------------------------------
# This file governs the behavior of the entire R-based analysis workflow.
# It defines file paths, maps analysis concepts to specific data files,
# and sets tunable parameters for deduplication and meta-analysis.

# ---
# 1. PATH DEFINITIONS
# ---
# Define the directory structure for inputs and outputs.
# The pipeline is designed to be robust to missing input files.
paths:
  # Input directory containing the processed CSV files from the Python pipeline.
  input_data_dir: "../outputs/processed/"

  # Output directory for all results generated by the R pipeline.
  output_dir: "../analysis/results_r/"

  # Sub-directory for detailed deduplication audit logs.
  dedup_dir: "../analysis/results_r/dedup/"

  # Sub-directory for plots and figures.
  plots_dir: "../analysis/results_r/plots/"

  # Central log for data exclusions.
  missing_data_log: "../analysis/results_r/missing_data_log.csv"

# ---
# 2. DATA FILE MAPPINGS
# ---
# Maps specific analysis types to their corresponding input CSV files.
# The file names are expected to be found in the `input_data_dir`.
file_mappings:
  ssi_incidence: "ssi_incidence.csv"
  mortality: "mortality.csv"
  amr_proportions: "amr_proportions.csv"
  risk_factors: "risk_factors.csv"
  length_of_stay: "length_of_stay.csv"
  economic_costs: "economic_costs.csv"
  qualitative_themes: "qualitative_themes.csv"
  # This file is not used for a specific analysis but is crucial for
  # building the master publication registry for deduplication.
  study_metadata: "study_metadata.csv"

# ---
# 3. DEDUPLICATION PARAMETERS
# ---
# Tunable settings for the algorithmic identification of duplicate publications.
deduplication:
  # Levenshtein distance threshold for fuzzy title matching.
  # A lower number means a stricter match.
  # Recommended value: 5
  title_levenshtein_dist: 5

  # Jaccard similarity threshold for author lists.
  # A value of 1.0 means identical author sets.
  # A value of 0.5 means 50% of the authors are shared.
  # Recommended value: 0.5
  author_jaccard_min: 0.5

  # Year difference tolerance.
  # Publications will not be considered duplicates if their years differ by more than this value.
  # Recommended value: 1
  year_diff_max: 1

  # The strict hierarchy for selecting the primary record from a duplicate cluster.
  # The pipeline will select the first record in the cluster that satisfies the
  # criteria, checked in the order they appear below.
  #
  # 1. "has_doi": Prefers records with a DOI.
  # 2. "has_pmid": Prefers records with a PubMed ID.
  # 3. "most_complete": Prefers the record with the fewest NA values across key fields.
  # 4. "latest_pub_date": Prefers the record with the most recent publication date.
  # 5. "first_in_list": As a final tie-breaker, takes the first record encountered.
  primary_record_selection_hierarchy:
    - "has_doi"
    - "has_pmid"
    - "most_complete"
    - "latest_pub_date"
    - "first_in_list"

# ---
# 4. META-ANALYSIS PARAMETERS
# ---
# Settings for the `meta` and `metafor` packages.
meta_analysis:
  # --- Proportional Meta-Analysis (meta::metaprop) ---
  proportions:
    # The method for pooling proportions.
    # "PLOGIT" = Logit transformation, suitable for proportions.
    # See `?meta::metaprop` for other options.
    sm: "PLOGIT"

    # The method for estimating the between-study variance (tau^2).
    # "REML" = Restricted maximum-likelihood, a robust default.
    method.tau: "REML"

    # The summary measure for the random-effects model.
    # "random" = Random-effects model.
    # "fixed" = Fixed-effects model.
    model.random: TRUE

    # Minimum number of studies required to perform a meta-analysis.
    min_studies: 2

  # --- Risk Factor Meta-Analysis (metafor::rma) ---
  risk_factors:
    # The summary measure for pooling effect sizes (OR, RR, HR).
    # These are typically log-transformed, so the measure is "GEN" (generic).
    measure: "GEN"

    # The method for estimating the between-study variance (tau^2).
    method: "REML"

    # Minimum number of studies required to perform a meta-analysis for a given risk factor.
    min_studies: 2
